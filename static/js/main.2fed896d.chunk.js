(this["webpackJsonpblog-user"]=this["webpackJsonpblog-user"]||[]).push([[0],{42:function(e,t,n){},44:function(e,t,n){},73:function(e,t,n){},77:function(e,t,n){"use strict";n.r(t);var a=n(1),r=n.n(a),s=n(31),c=n.n(s),i=n(9),o=(n(39),n(40),n(42),n(2)),u=n.n(o),l=n(6),m=n(4),p=n(5);function j(){return b.apply(this,arguments)}function b(){return(b=Object(l.a)(u.a.mark((function e(){var t,n,a=arguments;return u.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=a.length>0&&void 0!==a[0]?a[0]:"",e.next=3,fetch(t,{method:"GET",headers:{Authorization:"Bearer ".concat(localStorage.getItem("jwt"))}});case 3:return n=e.sent,e.abrupt("return",n.json());case 5:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function d(){return h.apply(this,arguments)}function h(){return(h=Object(l.a)(u.a.mark((function e(){var t,n,a,r=arguments;return u.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=r.length>0&&void 0!==r[0]?r[0]:"",n=r.length>1&&void 0!==r[1]?r[1]:{},e.next=4,fetch(t,{method:"POST",headers:{"Content-Type":"application/json",Authorization:"Bearer ".concat(localStorage.getItem("jwt"))},body:JSON.stringify(n)});case 4:return a=e.sent,e.abrupt("return",a.json());case 6:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function f(e){window.flashes([{msg:e.message}])}var O=n(32),x=new(n.n(O).a),v=(n(44),n(0));var g=function(e){var t=e.type,n=e.size;return Object(v.jsx)("div",{className:"BootstrapSpinner",children:Object(v.jsx)("div",{className:"spinner-".concat(t," text-primary"),style:{width:n,height:n},role:"status",children:Object(v.jsx)("span",{className:"sr-only",children:"Loading..."})})})};var w=function(e){var t=e.user,n=e.signOut;return Object(v.jsxs)("nav",{className:"navbar navbar-expand-lg navbar-dark bg-primary sticky-top mb-4",children:[Object(v.jsx)(i.c,{to:"/",className:"navbar-brand",children:"Blog User"}),Object(v.jsx)("button",{className:"navbar-toggler",type:"button","data-toggle":"collapse","data-target":"#navbarSupportedContent","aria-controls":"navbarSupportedContent","aria-expanded":"false","aria-label":"Toggle navigation",children:Object(v.jsx)("span",{className:"navbar-toggler-icon"})}),Object(v.jsx)("div",{className:"collapse navbar-collapse",id:"navbarSupportedContent",children:Object(v.jsxs)("ul",{className:"navbar-nav ml-auto",children:[Object(v.jsx)("li",{className:"nav-item",children:Object(v.jsx)(i.c,{exact:!0,to:"/posts",className:"nav-link",activeClassName:"active",children:"Posts"})}),t?Object(v.jsxs)("li",{className:"nav-item dropdown",children:[Object(v.jsx)("button",{className:"nav-link btn btn-link dropdown-toggle",id:"navbarDropdown","data-toggle":"dropdown","aria-haspopup":"true","aria-expanded":"false",children:t.username}),Object(v.jsx)("div",{className:"dropdown-menu dropdown-menu-right",children:Object(v.jsx)("button",{className:"dropdown-item",type:"button",onClick:n,children:"Sign out"})})]}):Object(v.jsxs)(v.Fragment,{children:[Object(v.jsx)("li",{className:"nav-item",children:Object(v.jsx)(i.c,{exact:!0,to:"/sign-up",className:"nav-link",activeClassName:"active",children:"Sign Up"})}),Object(v.jsx)("li",{className:"nav-item",children:Object(v.jsx)(i.c,{exact:!0,to:"/sign-in",className:"nav-link",activeClassName:"active",children:"Sign In"})})]})]})})]})},N=n(3),y=n(34);var k=function(){var e=Object(a.useState)([]),t=Object(m.a)(e,2),n=t[0],s=t[1];return Object(a.useEffect)((function(){x.addListener("flashes",(function(e){var t=e.map((function(e){return Object(N.a)(Object(N.a)({},e),{},{id:Object(y.a)()})}));s(t)}))}),[]),Object(a.useEffect)((function(){if(n.length>0){var e=setTimeout((function(){return s([])}),4e3);return function(){return clearTimeout(e)}}}),[n]),Object(v.jsx)(r.a.Fragment,{children:n.map((function(e){return Object(v.jsxs)("div",{className:"alert alert-".concat(e.type||"danger"," alert-dismissible"),role:"alert",children:[e.msg,Object(v.jsx)("button",{type:"button",className:"close","aria-label":"Close",onClick:function(){return function(e){var t=n.filter((function(t){return t.id!==e}));s(t)}(e.id)},children:Object(v.jsx)("span",{"aria-hidden":"true",children:"\xd7"})})]},e.id)}))})},S=function(){var e=Object(a.useState)(!1),t=Object(m.a)(e,2),n=t[0],r=t[1];return Object(a.useEffect)((function(){return r(!0),function(){return r(!1)}}),[]),n},C=function(e){var t=Object(a.useState)(!1),n=Object(m.a)(t,2),r=n[0],s=n[1];return[function(){return s(!0),e.apply(void 0,arguments).finally((function(){return s(!1)}))},r]},P=n(18),F=n.n(P);var D=function(e){var t=e.item;return Object(v.jsxs)("div",{className:"card mb-2",children:[Object(v.jsxs)("div",{className:"card-header",children:[Object(v.jsx)("h5",{className:"card-title",children:t.title}),Object(v.jsx)("p",{className:"card-subtitle mb-2",children:t.author.firstName+" "+t.author.lastName}),Object(v.jsx)("p",{className:"card-subtitle",children:F()(new Date(t.createdAt),"PPpp")})]}),Object(v.jsxs)("div",{className:"card-body",children:[Object(v.jsx)("p",{className:"card-text",children:t.body}),Object(v.jsxs)(i.b,{to:"/posts/".concat(t._id),className:"card-link",children:[t.comments.length," comments"]})]})]})};var I=function(e){var t=e.items.map((function(e){return Object(v.jsx)(D,{item:e},e._id)}));return Object(v.jsx)("section",{children:t})};var L=function(){var e=S(),t=C((function(e){return b.apply(this,arguments)})),n=Object(m.a)(t,2),r=n[0],s=n[1],c=Object(a.useState)([]),i=Object(m.a)(c,2),o=i[0],p=i[1];function b(){return(b=Object(l.a)(u.a.mark((function e(t){var n,a,r,s,c,i;return u.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(s=function(){return(s=Object(l.a)(u.a.mark((function e(t){var n;return u.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,Promise.all(t.map(function(){var e=Object(l.a)(u.a.mark((function e(t){var n;return u.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,j("".concat("https://blog-api-97575.herokuapp.com","/posts/").concat(t._id,"/comments"));case 3:if(!(n=e.sent).err){e.next=8;break}f(n.err),e.next=9;break;case 8:return e.abrupt("return",Object(N.a)(Object(N.a)({},t),{},{comments:n.comments}));case 9:e.next=14;break;case 11:e.prev=11,e.t0=e.catch(0),window.flashes([{msg:"Something went wrong, please try again later."}]);case 14:case"end":return e.stop()}}),e,null,[[0,11]])})));return function(t){return e.apply(this,arguments)}}()));case 3:return n=e.sent,e.abrupt("return",n);case 7:e.prev=7,e.t0=e.catch(0),window.flashes([{msg:"Something went wrong, please try again later."}]);case 10:case"end":return e.stop()}}),e,null,[[0,7]])})))).apply(this,arguments)},r=function(e){return s.apply(this,arguments)},a=function(){return(a=Object(l.a)(u.a.mark((function e(){var t;return u.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,j("".concat("https://blog-api-97575.herokuapp.com","/posts"));case 3:if(!(t=e.sent).err){e.next=8;break}f(t.err),e.next=9;break;case 8:return e.abrupt("return",t.posts);case 9:e.next=14;break;case 11:e.prev=11,e.t0=e.catch(0),window.flashes([{msg:"Something went wrong, please try again later."}]);case 14:case"end":return e.stop()}}),e,null,[[0,11]])})))).apply(this,arguments)},n=function(){return a.apply(this,arguments)},!t){e.next=12;break}return e.next=7,n();case 7:return c=e.sent,e.next=10,r(c);case 10:i=e.sent,p(i);case 12:case"end":return e.stop()}}),e)})))).apply(this,arguments)}return Object(a.useEffect)((function(){r(e)}),[e]),s?Object(v.jsx)(g,{type:"border",size:"2em"}):Object(v.jsx)(I,{items:o})},E=n(14);function q(e){var t=e.text;return e.isSubmitting?Object(v.jsxs)("button",{type:"submit",className:"btn btn-primary w-100",disabled:!0,children:[Object(v.jsx)("span",{className:"spinner-border spinner-border-sm",role:"status","aria-hidden":"true"}),"Submitting..."]}):Object(v.jsx)("button",{type:"submit",className:"btn btn-primary w-100",children:t})}q.defaultProps={text:"Submit"};var T=q;var z=function(e){var t=e.postId,n=e.updatePostComments,r=S(),s=C(d),c=Object(m.a)(s,2),i=c[0],o=c[1],p=Object(a.useState)({body:""}),j=Object(m.a)(p,2),b=j[0],h=j[1];function O(){return(O=Object(l.a)(u.a.mark((function e(a){var s;return u.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,a.preventDefault(),e.next=4,i("".concat("https://blog-api-97575.herokuapp.com","/posts/").concat(t,"/comments"),b);case 4:s=e.sent,r&&(h((function(e){return Object(N.a)(Object(N.a)({},e),{},{body:""})})),n(t)),window.flashes([{msg:"Comment successfully created",type:"success"}]),s.err?f(s.err):s.errors&&(r&&h((function(e){return Object(N.a)(Object(N.a)({},e),{},{body:s.comment.body})})),window.flashes(s.errors)),e.next=13;break;case 10:e.prev=10,e.t0=e.catch(0),window.flashes([{msg:"Something went wrong, please try again later."}]);case 13:case"end":return e.stop()}}),e,null,[[0,10]])})))).apply(this,arguments)}return Object(v.jsxs)("form",{onSubmit:function(e){return O.apply(this,arguments)},className:"mb-2",children:[Object(v.jsxs)("div",{className:"form-group",children:[Object(v.jsx)("label",{htmlFor:"body",children:"Write a comment"}),Object(v.jsx)("textarea",{className:"form-control",id:"body",name:"body",value:b.body,onChange:function(e){var t=e.target,n=t.name,a=t.value;h((function(e){return Object(N.a)(Object(N.a)({},e),{},Object(E.a)({},n,a))}))},required:!0,maxLength:200})]}),Object(v.jsx)(T,{text:"Comment",isSubmitting:o})]})};var B=function(e){var t=e.postComments;return t.length>0?Object(v.jsx)("ul",{className:"list-group",children:t.map((function(e){return Object(v.jsxs)("li",{className:"list-group-item",children:[Object(v.jsx)("p",{className:"h6 mb-1",children:e.author.firstName+" "+e.author.lastName}),Object(v.jsx)("p",{className:"text-muted mb-2",children:F()(new Date(e.createdAt),"PPpp")}),Object(v.jsx)("p",{className:"mb-2",children:e.body})]},e._id)}))}):null};var U=function(e){var t=e.user,n=Object(p.h)().postId,r=Object(p.g)(),s=S(),c=C((function(e,t){return k.apply(this,arguments)})),i=Object(m.a)(c,2),o=i[0],b=i[1],d=Object(a.useState)({}),h=Object(m.a)(d,2),O=h[0],x=h[1];function w(e){return y.apply(this,arguments)}function y(){return(y=Object(l.a)(u.a.mark((function e(t){var n;return u.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,j("".concat("https://blog-api-97575.herokuapp.com","/posts/").concat(t,"/comments"));case 3:if(!(n=e.sent).err){e.next=8;break}f(n.err),e.next=9;break;case 8:return e.abrupt("return",n.comments);case 9:e.next=14;break;case 11:e.prev=11,e.t0=e.catch(0),window.flashes([{msg:"Something went wrong, please try again later."}]);case 14:case"end":return e.stop()}}),e,null,[[0,11]])})))).apply(this,arguments)}function k(){return(k=Object(l.a)(u.a.mark((function e(t,n){var a,s,c,i;return u.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(s=function(){return(s=Object(l.a)(u.a.mark((function e(t){var n;return u.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,j("".concat("https://blog-api-97575.herokuapp.com","/posts/").concat(t));case 3:if(!(n=e.sent).err){e.next=9;break}[401,404].includes(n.err.status)&&r.push("/"),f(n.err),e.next=10;break;case 9:return e.abrupt("return",n.post);case 10:e.next=15;break;case 12:e.prev=12,e.t0=e.catch(0),window.flashes([{msg:"Something went wrong, please try again later."}]);case 15:case"end":return e.stop()}}),e,null,[[0,12]])})))).apply(this,arguments)},a=function(e){return s.apply(this,arguments)},!t){e.next=10;break}return e.next=5,a(n);case 5:return c=e.sent,e.next=8,w(n);case 8:i=e.sent,x(Object(N.a)(Object(N.a)({},c),{},{comments:i}));case 10:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function P(){return(P=Object(l.a)(u.a.mark((function e(t){var n;return u.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!s){e.next=5;break}return e.next=3,w(t);case 3:n=e.sent,x(Object(N.a)(Object(N.a)({},O),{},{comments:n}));case 5:case"end":return e.stop()}}),e)})))).apply(this,arguments)}return Object(a.useEffect)((function(){o(s,n)}),[s,n]),b?Object(v.jsx)(g,{type:"border",size:"2em"}):O._id?Object(v.jsxs)("section",{className:"mb-4",children:[Object(v.jsx)(D,{item:O}),t&&O.published&&Object(v.jsx)(z,{postId:n,updatePostComments:function(e){return P.apply(this,arguments)}}),Object(v.jsx)(B,{postComments:O.comments})]}):null};var _=function(){var e=Object(p.g)(),t=S(),n=C(d),r=Object(m.a)(n,2),s=r[0],c=r[1],i=Object(a.useState)({firstName:"",lastName:"",username:"",password:"",confirmPassword:""}),o=Object(m.a)(i,2),j=o[0],b=o[1];function h(e){var t=e.target,n=t.name,a=t.value;b((function(e){return Object(N.a)(Object(N.a)({},e),{},Object(E.a)({},n,a))}))}function O(){return(O=Object(l.a)(u.a.mark((function n(a){var r;return u.a.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return n.prev=0,a.preventDefault(),n.next=4,s("".concat("https://blog-api-97575.herokuapp.com","/users"),j);case 4:(r=n.sent).err?f(r.err):r.errors?(t&&b({firstName:r.userFormData.firstName,lastName:r.userFormData.lastName,username:r.userFormData.username,password:"",confirmPassword:""}),window.flashes(r.errors)):(window.flashes([{msg:"You have successfuly signed up",type:"success"}]),e.push("/")),n.next=11;break;case 8:n.prev=8,n.t0=n.catch(0),window.flashes([{msg:"Something went wrong, please try again later."}]);case 11:case"end":return n.stop()}}),n,null,[[0,8]])})))).apply(this,arguments)}return Object(v.jsxs)("form",{onSubmit:function(e){return O.apply(this,arguments)},children:[Object(v.jsxs)("div",{className:"form-group",children:[Object(v.jsx)("label",{htmlFor:"firstName",children:"First name"}),Object(v.jsx)("input",{type:"text",className:"form-control",id:"firstName",placeholder:"John",name:"firstName",value:j.firstName,required:!0,maxLength:"255",onChange:h})]}),Object(v.jsxs)("div",{className:"form-group",children:[Object(v.jsx)("label",{htmlFor:"lastName",children:"Last name"}),Object(v.jsx)("input",{type:"text",className:"form-control",id:"lastName",placeholder:"Doe",name:"lastName",value:j.lastName,required:!0,maxLength:"255",onChange:h})]}),Object(v.jsxs)("div",{className:"form-group",children:[Object(v.jsx)("label",{htmlFor:"username",children:"Username"}),Object(v.jsx)("input",{type:"text",className:"form-control",id:"username",placeholder:"johnDoe01",name:"username",value:j.username,required:!0,maxLength:"20",onChange:h})]}),Object(v.jsxs)("div",{className:"form-group",children:[Object(v.jsx)("label",{htmlFor:"password",children:"Password"}),Object(v.jsx)("input",{type:"password",className:"form-control",id:"password",name:"password",value:j.password,required:!0,minLength:"8",onChange:h})]}),Object(v.jsxs)("div",{className:"form-group",children:[Object(v.jsx)("label",{htmlFor:"confirmPassword",children:"Password confirmation"}),Object(v.jsx)("input",{type:"password",className:"form-control",id:"confirmPassword",name:"confirmPassword",value:j.confirmPassword,required:!0,minLength:"8",onChange:h})]}),Object(v.jsx)(T,{isSubmitting:c})]})};var A=function(e){var t=e.setUser,n=Object(p.g)(),r=S(),s=C(d),c=Object(m.a)(s,2),i=c[0],o=c[1],j=Object(a.useState)({username:"",password:""}),b=Object(m.a)(j,2),h=b[0],O=b[1];function x(e){var t=e.target,n=t.name,a=t.value;O((function(e){return Object(N.a)(Object(N.a)({},e),{},Object(E.a)({},n,a))}))}function g(){return(g=Object(l.a)(u.a.mark((function e(a){var s;return u.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,a.preventDefault(),e.next=4,i("".concat("https://blog-api-97575.herokuapp.com","/auth/sign-in"),h);case 4:(s=e.sent).err?(r&&O((function(e){return Object(N.a)(Object(N.a)({},e),{},{password:""})})),f(s.err)):(localStorage.setItem("jwt",s.token),t(s.user),window.flashes([{msg:"You have successfuly signed in",type:"success"}]),n.push("/")),e.next=11;break;case 8:e.prev=8,e.t0=e.catch(0),window.flashes([{msg:"Something went wrong, please try again later."}]);case 11:case"end":return e.stop()}}),e,null,[[0,8]])})))).apply(this,arguments)}return Object(v.jsxs)("form",{onSubmit:function(e){return g.apply(this,arguments)},children:[Object(v.jsxs)("div",{className:"form-group",children:[Object(v.jsx)("label",{htmlFor:"username",children:"Username"}),Object(v.jsx)("input",{type:"text",className:"form-control",id:"username",placeholder:"johnDoe01",name:"username",value:h.username,required:!0,maxLength:"20",onChange:x})]}),Object(v.jsxs)("div",{className:"form-group",children:[Object(v.jsx)("label",{htmlFor:"password",children:"Password"}),Object(v.jsx)("input",{type:"password",className:"form-control",id:"password",name:"password",value:h.password,required:!0,minLength:"8",onChange:x})]}),Object(v.jsx)(T,{isSubmitting:o})]})};n(73);var J=function(){var e=Object(p.g)(),t=Object(a.useState)(null),n=Object(m.a)(t,2),r=n[0],s=n[1];return Object(a.useEffect)((function(){window.flashes=function(e){return x.emit("flashes",e)}}),[]),Object(a.useEffect)((function(){function e(){return t.apply(this,arguments)}function t(){return(t=Object(l.a)(u.a.mark((function e(){var t;return u.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,j("".concat("https://blog-api-97575.herokuapp.com","/users/current-user"));case 2:t=e.sent,s(t.user);case 4:case"end":return e.stop()}}),e)})))).apply(this,arguments)}e();var n=setInterval(e,3e4);return function(){return clearInterval(n)}}),[]),null===r?Object(v.jsx)(g,{type:"grow",size:"3em"}):Object(v.jsxs)(v.Fragment,{children:[Object(v.jsx)(w,{user:r,signOut:function(){localStorage.removeItem("jwt"),s(!1),window.flashes([{msg:"You have successfully signed out",type:"success"}]),e.push("/")}}),Object(v.jsx)("div",{className:"container",children:Object(v.jsx)("div",{className:"row justify-content-center",children:Object(v.jsx)("div",{className:"col-md-8",children:Object(v.jsx)(k,{})})})}),Object(v.jsx)("main",{className:"h-100",children:Object(v.jsxs)(p.d,{children:[Object(v.jsx)(p.b,{exact:!0,path:"/",children:Object(v.jsx)(p.a,{to:"/posts"})}),Object(v.jsx)(p.b,{exact:!0,path:"/posts",children:Object(v.jsx)("div",{className:"h-100 container",children:Object(v.jsx)("div",{className:"h-100 row justify-content-center",children:Object(v.jsx)("div",{className:"col-md-8 position-relative",children:Object(v.jsx)(L,{})})})})}),Object(v.jsx)(p.b,{exact:!0,path:"/posts/:postId",children:Object(v.jsx)("div",{className:"h-100 container",children:Object(v.jsx)("div",{className:"h-100 row justify-content-center",children:Object(v.jsx)("div",{className:"col-md-8 position-relative",children:Object(v.jsx)(U,{user:r})})})})}),Object(v.jsx)(p.b,{exact:!0,path:"/sign-up",children:Object(v.jsx)("div",{className:"container",children:Object(v.jsx)("div",{className:"row justify-content-center",children:Object(v.jsx)("div",{className:"col-md-6",children:Object(v.jsx)(_,{})})})})}),Object(v.jsx)(p.b,{exact:!0,path:"/sign-in",children:Object(v.jsx)("div",{className:"container",children:Object(v.jsx)("div",{className:"row justify-content-center",children:Object(v.jsx)("div",{className:"col-md-6",children:Object(v.jsx)(A,{setUser:s})})})})})]})})]})},Y=function(e){e&&e instanceof Function&&n.e(3).then(n.bind(null,78)).then((function(t){var n=t.getCLS,a=t.getFID,r=t.getFCP,s=t.getLCP,c=t.getTTFB;n(e),a(e),r(e),s(e),c(e)}))};n(74).config(),c.a.render(Object(v.jsx)(r.a.StrictMode,{children:Object(v.jsx)(i.a,{basename:"/blog-user",children:Object(v.jsx)(J,{})})}),document.getElementById("root")),Y()}},[[77,1,2]]]);
//# sourceMappingURL=main.2fed896d.chunk.js.map